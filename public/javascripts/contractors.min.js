"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),function(){var e=exports.canUpdate,t=exports.urlPrefix;cityssm.htmlModalFolder=t+"/html/";var a,n=document.getElementById("form--filters"),r=document.getElementById("container--results"),o=[],s={tradeCategories:[],healthSafetyStatuses:[],insuranceCompanyNames:[]},c=function(e){e.preventDefault();var t=document.getElementById("contractor--docuShareCollectionID").value;""===t?cityssm.alertModal("DocuShare Collection ID Not Available","Note that Hire Ready contractors will have their Collection IDs populated automatically.","OK","warning"):window.open(function(e){return exports.docuShareRootURL+"/dsweb/View/Collection-"+e}(t))},i=!1,l=function(e){e.preventDefault();var a=e.currentTarget,n=a.getAttribute("data-action");cityssm.postJSON(t+"/contractors/"+n,a,function(e){e.success?(cityssm.alertModal("Update Saved Successfully","Close the contractor popup window to refresh your search results.","OK","success"),i=!0):cityssm.alertModal("Update Failed","Please try again.","OK","danger")})},d=function(e){e.preventDefault();var n=document.getElementById("tradeCategories--tradeCategoryID").value;if(""!==n)if(a.has(parseInt(n,10)))cityssm.alertModal("Trade Category Already Included","No need to add it twice.","OK","info");else{var r=e.currentTarget;cityssm.postJSON(t+"/contractors/doAddTradeCategory",r,function(e){if(e.success){var t=parseInt(r.getElementsByClassName("contractor--contractorID")[0].value,10),o=function(e){return s.tradeCategories.find(function(t){return t.tradeCategoryID===e})}(parseInt(n,10)),c=g(t,o),l=document.getElementById("contractor--tradeCategories");l.classList.contains("panel")||(l.innerHTML="",l.classList.add("panel")),l.insertAdjacentElement("afterbegin",c),a.set(o.tradeCategoryID,o.tradeCategory),i=!0}else cityssm.alertModal("Adding Trade Category Failed","An error occurred while trying to add the trade category. Is it already included?","OK","warning")})}else cityssm.alertModal("No Trade Category Selected","Please select a trade category from the list.","OK","warning")},u=function(e){var a,n=e.currentTarget,r=document.getElementById("contractor--docuShareCollectionID"),o=r.value,s=function(){cityssm.openHtmlModal("contractor-createDSCollection-loading",{onshown:function(e,o){var s;a=o,s=n.getAttribute("data-contractor-id"),cityssm.postJSON(t+"/contractors/doCreateDocuShareCollection",{contractorID:s},function(e){a(),e.success?r.value=e.docuShareCollectionID:cityssm.alertModal("DocuShare Collection Not Created",cityssm.escapeHTML(e.message),"OK","danger")})}})};""===o?cityssm.confirmModal("Create a New Collection in DocuShare","Are you sure you want to create a new DocuShare Collection for this contractor?","Yes, Create Collection","info",s):cityssm.confirmModal("Create a New Collection in DocuShare","<strong>A Collection already exists for this contractor.</strong> Are you sure you want to abandon the existing Collection and create a new DocuShare Collection?","Yes, Abandon and Create","danger",s)},m=function(e){var n=e.currentTarget;cityssm.confirmModal("Remove Trade Category?","Are you sure you want to remove the trade category from the contractor?","Yes, Remove It","warning",function(){var e=n.getAttribute("data-contractor-id"),r=n.getAttribute("data-trade-category-id");cityssm.postJSON(t+"/contractors/doRemoveTradeCategory",{contractorID:e,tradeCategoryID:r},function(e){e.success?(n.closest(".panel-block").remove(),a.delete(parseInt(r,10)),i=!0):cityssm.alertModal("Remove Failed","An error occurred removing this trade category. Please try again.","OK","danger")})})},g=function(t,a){var n=document.createElement("div");if(n.className="panel-block",n.innerHTML='<span class="panel-icon"><i class="fas fa-book" aria-hidden="true"></i></span><span class="is-flex-grow-1">'+cityssm.escapeHTML(a.tradeCategory)+"</span>",e){var r=document.createElement("button");r.className="button is-small is-danger is-inverted is-edit-control-flex",r.type="button",r.setAttribute("data-contractor-id",t.toString()),r.setAttribute("data-trade-category-id",a.tradeCategoryID.toString()),r.innerHTML='<i class="fas fa-times" aria-hidden="true"></i><span class="sr-only">Remove</span>',r.addEventListener("click",m),n.appendChild(r)}return n},p=function(e){var a,n=e.currentTarget,r=n.closest("form");switch(r.getAttribute("data-action")){case"doUpdateHealthSafety":a=function(){var e=document.createElement("optgroup");e.label="Options";for(var t=0,a=s.healthSafetyStatuses;t<a.length;t++){var n=a[t];e.insertAdjacentHTML("beforeend","<option>"+cityssm.escapeHTML(n)+"</option>")}document.getElementById("contractor--healthSafety_status").appendChild(e)},s.healthSafetyStatuses.length>0?a():cityssm.postJSON(t+"/contractors/doGetHealthSafetyOptions",{},function(e){s.healthSafetyStatuses=e.healthSafetyStatuses,a()});break;case"doUpdateLegal":document.getElementById("contractor--legal_isSatisfactory").insertAdjacentHTML("beforeend",'<optgroup label="Options"><option value="1">Approved</option><option value="0">Declined</option></optgroup>');break;case"doUpdateInsurance":!function(){var e=function(){for(var e=document.getElementById("contractor--insurance_company-datalist"),t=0,a=s.insuranceCompanyNames;t<a.length;t++){var n=a[t];e.insertAdjacentHTML("beforeend",'<option value="'+cityssm.escapeHTML(n)+'"></option>')}};s.insuranceCompanyNames.length>0?e():cityssm.postJSON(t+"/contractors/doGetInsuranceOptions",{},function(t){s.insuranceCompanyNames=t.insuranceCompanyNames,e()})}()}r.addEventListener("submit",l),r.getElementsByTagName("fieldset")[0].disabled=!1,n.remove()},y=function(e){var t=e.currentTarget.closest(".control"),a=t.closest("form");a.classList.add("is-edit-mode"),a.addEventListener("submit",l);var n=document.getElementById("contractor--docuShareCollectionID-create");n.addEventListener("click",u),n.setAttribute("data-contractor-id",a.getElementsByClassName("contractor--contractorID")[0].value),document.getElementById("contractor--docuShareCollectionID").disabled=!1,t.remove()},f=function(e){var a,n=e.currentTarget.closest(".is-unlock-tradecategories-container"),r=document.getElementById("form--tradeCategories");document.getElementById("contractor--tradeCategories").classList.add("is-edit-mode"),a=function(){for(var e=document.getElementById("tradeCategories--tradeCategoryID"),t=0,a=s.tradeCategories;t<a.length;t++){var n=a[t];e.insertAdjacentHTML("beforeend",'<option value="'+n.tradeCategoryID.toString()+'">'+n.tradeCategory+"</option>")}},s.tradeCategories.length>0?a():cityssm.postJSON(t+"/contractors/doGetAllTradeCategories",{},function(e){s.tradeCategories=e.tradeCategories,a()}),r.addEventListener("submit",d),r.classList.remove("is-hidden"),n.remove()},h=function(n){n.preventDefault();var r=parseInt(n.currentTarget.getAttribute("data-index"),10),s=o[r];cityssm.openHtmlModal("contractor-view",{onshow:function(n){document.getElementsByTagName("html")[0].classList.add("is-clipped"),a=new Map,cityssm.postJSON(t+"/contractors/doGetTradeCategoriesByContractorID",{contractorID:s.contractorID},function(e){var t=document.getElementById("contractor--tradeCategories");if(0!==e.tradeCategories.length){t.innerHTML="",t.classList.add("panel");for(var n=0,r=e.tradeCategories;n<r.length;n++){var o=r[n];a.set(o.tradeCategoryID,o.tradeCategory);var c=g(s.contractorID,o);t.appendChild(c)}}else t.innerHTML='<div class="message is-warning"><div class="message-body">There are no trade categories assigned to this contractor.</div></div>'}),document.getElementById("contractor--contractor_name").innerText=s.contractor_name;var r=(s.contractor_city?s.contractor_city+", ":"")+(s.contractor_province||"");document.getElementById("contractor--location").innerText=r&&""!==r?r:"(Unavailable)",document.getElementById("contractor--phone_name").innerText=s.phone_name&&""!==s.phone_name?s.phone_name:"(Unavailable)",document.getElementById("contractor--phone_number").innerText=s.phone_number&&""!==s.phone_number?s.phone_number:"(Unavailable)",s.docuShareCollectionID&&(document.getElementById("contractor--docuShareCollectionID").value=s.docuShareCollectionID.toString()),document.getElementById("contractor--docuShareCollectionID-link").addEventListener("click",c),document.getElementById("contractor--healthSafety_status").innerHTML=null===s.healthSafety_status||""===s.healthSafety_status?'<option value="">(Not Set)</option>':"<option>"+cityssm.escapeHTML(s.healthSafety_status)+"</option>";var o=s.legal_isSatisfactory?'<option value="1">Approved</option>':'<option value="0">Declined</option>';if(document.getElementById("contractor--legal_isSatisfactory").innerHTML=o,document.getElementById("contractor--wsib_accountNumber").value=s.wsib_accountNumber,document.getElementById("contractor--wsib_firmNumber").value=s.wsib_firmNumber,s.wsib_effectiveDate){var i=new Date(s.wsib_effectiveDate),l=cityssm.dateToString(i);document.getElementById("contractor--wsib_effectiveDate").value=l}if(s.wsib_expiryDate){var d=new Date(s.wsib_expiryDate),u=cityssm.dateToString(d);document.getElementById("contractor--wsib_expiryDate").value=u}if(s.wsib_isIndependent&&(document.getElementById("contractor--wsib_isIndependent").checked=!0),document.getElementById("contractor--insurance_company").value=s.insurance_company||"",document.getElementById("contractor--insurance_policyNumber").value=s.insurance_policyNumber||"",document.getElementById("contractor--insurance_amount").value=s.insurance_amount.toString(),s.insurance_expiryDate){d=new Date(s.insurance_expiryDate),u=cityssm.dateToString(d);document.getElementById("contractor--insurance_expiryDate").value=u}if(e)for(var m=n.getElementsByClassName("contractor--contractorID"),p=0;p<m.length;p+=1)m[p].value=s.contractorID.toString()},onshown:function(t){if(e){var a=t.getElementsByClassName("is-unlock-contractor-control")[0];a.classList.remove("is-hidden"),a.getElementsByTagName("button")[0].addEventListener("click",y);var n=t.getElementsByClassName("is-unlock-tradecategories-container")[0];n.classList.remove("is-hidden"),n.getElementsByTagName("button")[0].addEventListener("click",f);for(var r=t.getElementsByClassName("is-unlock-button"),o=0;o<r.length;o+=1)r[o].classList.remove("is-hidden"),r[o].addEventListener("click",p)}},onhidden:function(){i&&(C(),i=!1)},onremoved:function(){document.getElementsByTagName("html")[0].classList.remove("is-clipped")}})},v=function(e){return e.isContractor&&e.healthSafety_isSatisfactory&&e.legal_isSatisfactory&&e.wsib_isSatisfactory&&e.insurance_isSatisfactory},b=function(e,t){var a=document.createElement("div");a.className="panel-block is-block";var n=document.createElement("div");return n.className="columns is-mobile is-multiline",n.innerHTML='<div class="column is-full-mobile is-full-tablet is-half-widescreen"><a class="is-size-5 has-text-weight-bold" data-index="'+t.toString()+'" role="button" href="#">'+cityssm.escapeHTML(e.contractor_name)+"</a><br />"+(v(e)?'<span class="icon"><i class="fas fa-phone" aria-hidden="true"></i></span> <span>'+e.phone_number+"</span>":'<span class="has-text-weight-semibold has-text-danger"><span class="icon"><i class="fas fa-exclamation-triangle" aria-hidden="true"></i></span> Not Hire Ready</span>')+'</div><div class="column pt-4 has-text-centered">'+function(e){return'<span class="icon">'+(e.healthSafety_isSatisfactory?'<i class="fas fa-2x fa-check-circle has-text-success" aria-hidden="true"></i>':'<i class="fas fa-2x fa-times-circle has-text-danger" aria-hidden="true"></i>')+'</span><br /><span class="is-size-7 has-text-weight-semibold">Health & Safety</span>'}(e)+'</div><div class="column pt-4 has-text-centered">'+function(e){return'<span class="icon">'+(e.legal_isSatisfactory?'<i class="fas fa-2x fa-check-circle has-text-success" aria-hidden="true"></i>':'<i class="fas fa-2x fa-times-circle has-text-danger" aria-hidden="true"></i>')+'</span><br /><span class="is-size-7 has-text-weight-semibold">Legal</span>'}(e)+'</div><div class="column pt-4 has-text-centered">'+function(e){var t="";return e.wsib_isIndependent?t="Independent Contractor":e.wsib_isSatisfactory&&(t="Expires "+cityssm.dateToString(new Date(e.wsib_expiryDate))),'<span class="icon"'+(""===t?"":' data-tooltip="'+t+'"')+">"+(e.wsib_isSatisfactory?'<i class="fas fa-2x fa-check-circle has-text-success" aria-hidden="true"></i>':'<i class="fas fa-2x fa-times-circle has-text-danger" aria-hidden="true"></i>')+'</span><br /><span class="is-size-7 has-text-weight-semibold">WSIB</span>'}(e)+'</div><div class="column pt-4 has-text-centered">'+function(e){var t="";return e.insurance_isSatisfactory?t="Expires "+cityssm.dateToString(new Date(e.insurance_expiryDate)):e.insurance_expiryDate&&(t="Expired "+cityssm.dateToString(new Date(e.insurance_expiryDate))),'<span class="icon"'+(""===t?"":' data-tooltip="'+t+'"')+">"+(e.insurance_isSatisfactory?'<i class="fas fa-2x fa-check-circle has-text-success" aria-hidden="true"></i>':'<i class="fas fa-2x fa-times-circle has-text-danger" aria-hidden="true"></i>')+'</span><br /><span class="is-size-7 has-text-weight-semibold">Insurance</span>'}(e)+"</div>",n.getElementsByTagName("a")[0].addEventListener("click",h),a.appendChild(n),a},C=function(){o=[],cityssm.clearElement(r),r.innerHTML='<div class="has-text-centered p-4"><span class="icon"><i class="fas fa-4x fa-spinner fa-pulse" aria-hidden="true"></i></span></div>',cityssm.postJSON(t+"/contractors/doGetContractors",n,function(e){if(0!==(o=e.contractors).length){var t=0,a=document.createElement("div");a.className="panel",o.forEach(function(e,n){var r=b(e,n);a.appendChild(r),v(e)&&(t+=1)});var n="";0===t?n+='<span class="has-text-danger">No Displayed Contractors are Hire Ready</span>':t===o.length?n+='<span class="has-text-success">All Displayed Contractors are Hire Ready</span>':n+='<span class="has-text-success">'+t.toString()+" out of "+o.length.toString()+" Contractors are Hire Ready</span>",r.innerHTML='<div class="mb-5 has-text-centered has-text-weight-bold">Displaying '+o.length.toString()+" contractor"+(1===o.length?"":"s")+"<br />"+n+"</div>",r.appendChild(a)}else r.innerHTML='<div class="message is-info"><div class="message-body">There are no contractors available that meet your search criteria.</div></div>'})};n.addEventListener("submit",function(e){e.preventDefault()}),C(),document.getElementById("filter--contractorName").addEventListener("change",C),document.getElementById("filter--tradeCategoryID").addEventListener("change",C),document.getElementById("filter--isHireReady").addEventListener("change",function(){C()})}();