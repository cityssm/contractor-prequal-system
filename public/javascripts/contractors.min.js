"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),(()=>{const e=exports.canUpdate,t=exports.urlPrefix;cityssm.htmlModalFolder=t+"/html/";const a=document.getElementById("form--filters"),s=document.getElementById("container--results");let n=[];const c={healthSafetyStatuses:[],insuranceCompanyNames:[]};let i=!1;const o=e=>{e.preventDefault();const a=e.currentTarget,s=a.getAttribute("data-action");cityssm.postJSON(t+"/contractors/"+s,a,e=>{e.success?(cityssm.alertModal("Update Saved Successfully","Close the contractor popup window to refresh your search results.","OK","success"),i=!0):cityssm.alertModal("Update Failed","Please try again.","OK","danger")})},r=e=>{const a=e.currentTarget,s=a.closest("form");switch(s.getAttribute("data-action")){case"doUpdateHealthSafety":(()=>{const e=()=>{const e=document.createElement("optgroup");e.label="Options";for(const t of c.healthSafetyStatuses)e.insertAdjacentHTML("beforeend","<option>"+cityssm.escapeHTML(t)+"</option>");document.getElementById("contractor--healthSafety_status").appendChild(e)};c.healthSafetyStatuses.length>0?e():cityssm.postJSON(t+"/contractors/doGetHealthSafetyOptions",{},t=>{c.healthSafetyStatuses=t.healthSafetyStatuses,e()})})();break;case"doUpdateLegal":document.getElementById("contractor--legal_isSatisfactory").insertAdjacentHTML("beforeend",'<optgroup label="Options"><option value="1">Approved</option><option value="0">Declined</option></optgroup>');break;case"doUpdateInsurance":(()=>{const e=()=>{const e=document.getElementById("contractor--insurance_company-datalist");for(const t of c.insuranceCompanyNames)e.insertAdjacentHTML("beforeend",'<option value="'+cityssm.escapeHTML(t)+'"></option>')};c.insuranceCompanyNames.length>0?e():cityssm.postJSON(t+"/contractors/doGetInsuranceOptions",{},t=>{c.insuranceCompanyNames=t.insuranceCompanyNames,e()})})()}s.getElementsByTagName("fieldset")[0].disabled=!1,s.addEventListener("submit",o),a.remove()},l=a=>{a.preventDefault();const s=parseInt(a.currentTarget.getAttribute("data-index"),10),c=n[s];cityssm.openHtmlModal("contractor-view",{onshow:a=>{document.getElementsByTagName("html")[0].classList.add("is-clipped"),cityssm.postJSON(t+"/contractors/doGetTradeCategoriesByContractorID",{contractorID:c.contractorID},e=>{const t=document.getElementById("contractor--tradeCategories");if(0!==e.tradeCategories.length){t.innerHTML="",t.classList.add("panel");for(const a of e.tradeCategories){const e=document.createElement("div");e.className="panel-block",e.innerHTML='<span class="panel-icon"><i class="fas fa-book" aria-hidden="true"></i></span> '+cityssm.escapeHTML(a.tradeCategory),t.appendChild(e)}}else t.innerHTML='<div class="message is-warning"><div class="message-body">There are no trade categories assigned to this contractor.</div></div>'}),document.getElementById("contractor--contractor_name").innerText=c.contractor_name,document.getElementById("contractor--location").innerText=(c.contractor_city?c.contractor_city+", ":"")+(c.contractor_province||""),document.getElementById("contractor--phone_name").innerText=c.phone_name,document.getElementById("contractor--phone_number").innerText=c.phone_number,document.getElementById("contractor--healthSafety_status").innerHTML=null===c.healthSafety_status||""===c.healthSafety_status?'<option value="">(Not Set)</option>':"<option>"+cityssm.escapeHTML(c.healthSafety_status)+"</option>";const s=c.legal_isSatisfactory?'<option value="1">Approved</option>':'<option value="0">Declined</option>';if(document.getElementById("contractor--legal_isSatisfactory").innerHTML=s,document.getElementById("contractor--wsib_accountNumber").value=c.wsib_accountNumber,document.getElementById("contractor--wsib_firmNumber").value=c.wsib_firmNumber,c.wsib_effectiveDate){const e=new Date(c.wsib_effectiveDate),t=cityssm.dateToString(e);document.getElementById("contractor--wsib_effectiveDate").value=t}if(c.wsib_expiryDate){const e=new Date(c.wsib_expiryDate),t=cityssm.dateToString(e);document.getElementById("contractor--wsib_expiryDate").value=t}if(c.wsib_isIndependent&&(document.getElementById("contractor--wsib_isIndependent").checked=!0),document.getElementById("contractor--insurance_company").value=c.insurance_company||"",document.getElementById("contractor--insurance_policyNumber").value=c.insurance_policyNumber||"",document.getElementById("contractor--insurance_amount").value=c.insurance_amount.toString(),c.insurance_expiryDate){const e=new Date(c.insurance_expiryDate),t=cityssm.dateToString(e);document.getElementById("contractor--insurance_expiryDate").value=t}if(e){const e=a.getElementsByClassName("contractor--contractorID");for(let t=0;t<e.length;t+=1)e[t].value=c.contractorID.toString()}},onshown:t=>{if(e){const e=t.getElementsByClassName("is-unlock-button");for(let t=0;t<e.length;t+=1)e[t].classList.remove("is-hidden"),e[t].addEventListener("click",r)}},onhidden:()=>{i&&(d(),i=!1)},onremoved:()=>{document.getElementsByTagName("html")[0].classList.remove("is-clipped")}})},d=()=>{n=[],cityssm.clearElement(s),s.innerHTML='<div class="has-text-centered p-4"><span class="icon"><i class="fas fa-4x fa-spinner fa-pulse" aria-hidden="true"></i></span></div>',cityssm.postJSON(t+"/contractors/doGetContractors",a,e=>{if(0===(n=e.contractors).length)return void(s.innerHTML='<div class="message is-info"><div class="message-body">There are no contractors available that meet your search criteria.</div></div>');const t=document.createElement("div");t.className="panel",n.forEach((e,a)=>{const s=((e,t)=>{const a=document.createElement("div");a.className="panel-block is-block";const s=document.createElement("div");return s.className="columns is-mobile is-multiline",s.innerHTML='<div class="column is-full-mobile is-full-tablet is-half-widescreen"><a class="has-text-weight-bold" data-index="'+t.toString()+'" role="button" href="#">'+cityssm.escapeHTML(e.contractor_name)+"</a><br />"+((e=>e.isContractor&&e.healthSafety_isSatisfactory&&e.legal_isSatisfactory&&e.wsib_isSatisfactory&&e.insurance_isSatisfactory)(e)?'<span class="icon"><i class="fas fa-phone" aria-hidden="true"></i></span> <span>'+e.phone_number+"</span>":'<span class="has-text-weight-semibold has-text-danger"><span class="icon"><i class="fas fa-exclamation-triangle" aria-hidden="true"></i></span> Not Hire Ready</span>')+'</div><div class="column pt-4 has-text-centered">'+(e=>'<span class="icon">'+(e.healthSafety_isSatisfactory?'<i class="fas fa-2x fa-check-circle has-text-success" aria-hidden="true"></i>':'<i class="fas fa-2x fa-times-circle has-text-danger" aria-hidden="true"></i>')+'</span><br /><span class="is-size-7 has-text-weight-semibold">Health & Safety</span>')(e)+'</div><div class="column pt-4 has-text-centered">'+(e=>'<span class="icon">'+(e.legal_isSatisfactory?'<i class="fas fa-2x fa-check-circle has-text-success" aria-hidden="true"></i>':'<i class="fas fa-2x fa-times-circle has-text-danger" aria-hidden="true"></i>')+'</span><br /><span class="is-size-7 has-text-weight-semibold">Legal</span>')(e)+'</div><div class="column pt-4 has-text-centered">'+(e=>'<span class="icon">'+(e.wsib_isSatisfactory?'<i class="fas fa-2x fa-check-circle has-text-success" aria-hidden="true"></i>':'<i class="fas fa-2x fa-times-circle has-text-danger" aria-hidden="true"></i>')+'</span><br /><span class="is-size-7 has-text-weight-semibold">WSIB</span>')(e)+'</div><div class="column pt-4 has-text-centered">'+(e=>'<span class="icon">'+(e.insurance_isSatisfactory?'<i class="fas fa-2x fa-check-circle has-text-success" aria-hidden="true"></i>':'<i class="fas fa-2x fa-times-circle has-text-danger" aria-hidden="true"></i>')+'</span><br /><span class="is-size-7 has-text-weight-semibold">Insurance</span>')(e)+"</div>",s.getElementsByTagName("a")[0].addEventListener("click",l),a.appendChild(s),a})(e,a);t.appendChild(s)}),s.innerHTML="",s.appendChild(t)})};a.addEventListener("submit",e=>{e.preventDefault()}),d(),document.getElementById("filter--tradeCategoryID").addEventListener("change",d),document.getElementById("filter--isHireReady").addEventListener("change",()=>{d()})})();