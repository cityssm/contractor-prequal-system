"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),function(){var e=exports.canUpdate,t=exports.urlPrefix;cityssm.htmlModalFolder=t+"/html/";var a=document.getElementById("form--filters"),n=document.getElementById("container--results"),s=[],i={healthSafetyStatuses:[],insuranceCompanyNames:[]},c=!1,r=function(e){e.preventDefault();var a=e.currentTarget,n=a.getAttribute("data-action");cityssm.postJSON(t+"/contractors/"+n,a,function(e){e.success?(cityssm.alertModal("Update Saved Successfully","Close the contractor popup window to refresh your search results.","OK","success"),c=!0):cityssm.alertModal("Update Failed","Please try again.","OK","danger")})},o=function(e){var a,n=e.currentTarget,s=n.closest("form");switch(s.getAttribute("data-action")){case"doUpdateHealthSafety":a=function(){var e=document.createElement("optgroup");e.label="Options";for(var t=0,a=i.healthSafetyStatuses;t<a.length;t++){var n=a[t];e.insertAdjacentHTML("beforeend","<option>"+cityssm.escapeHTML(n)+"</option>")}document.getElementById("contractor--healthSafety_status").appendChild(e)},i.healthSafetyStatuses.length>0?a():cityssm.postJSON(t+"/contractors/doGetHealthSafetyOptions",{},function(e){i.healthSafetyStatuses=e.healthSafetyStatuses,a()});break;case"doUpdateLegal":document.getElementById("contractor--legal_isSatisfactory").insertAdjacentHTML("beforeend",'<optgroup label="Options"><option value="1">Approved</option><option value="0">Declined</option></optgroup>');break;case"doUpdateInsurance":!function(){var e=function(){for(var e=document.getElementById("contractor--insurance_company-datalist"),t=0,a=i.insuranceCompanyNames;t<a.length;t++){var n=a[t];e.insertAdjacentHTML("beforeend",'<option value="'+cityssm.escapeHTML(n)+'"></option>')}};i.insuranceCompanyNames.length>0?e():cityssm.postJSON(t+"/contractors/doGetInsuranceOptions",{},function(t){i.insuranceCompanyNames=t.insuranceCompanyNames,e()})}()}s.getElementsByTagName("fieldset")[0].disabled=!1,s.addEventListener("submit",r),n.remove()},l=function(a){a.preventDefault();var n=parseInt(a.currentTarget.getAttribute("data-index"),10),i=s[n];cityssm.openHtmlModal("contractor-view",{onshow:function(a){document.getElementsByTagName("html")[0].classList.add("is-clipped"),cityssm.postJSON(t+"/contractors/doGetTradeCategoriesByContractorID",{contractorID:i.contractorID},function(e){var t=document.getElementById("contractor--tradeCategories");if(0!==e.tradeCategories.length){t.innerHTML="",t.classList.add("panel");for(var a=0,n=e.tradeCategories;a<n.length;a++){var s=n[a],i=document.createElement("div");i.className="panel-block",i.innerHTML='<span class="panel-icon"><i class="fas fa-book" aria-hidden="true"></i></span> '+cityssm.escapeHTML(s.tradeCategory),t.appendChild(i)}}else t.innerHTML='<div class="message is-warning"><div class="message-body">There are no trade categories assigned to this contractor.</div></div>'}),document.getElementById("contractor--contractor_name").innerText=i.contractor_name,document.getElementById("contractor--location").innerText=(i.contractor_city?i.contractor_city+", ":"")+(i.contractor_province||""),document.getElementById("contractor--phone_name").innerText=i.phone_name,document.getElementById("contractor--phone_number").innerText=i.phone_number,document.getElementById("contractor--healthSafety_status").innerHTML=null===i.healthSafety_status||""===i.healthSafety_status?'<option value="">(Not Set)</option>':"<option>"+cityssm.escapeHTML(i.healthSafety_status)+"</option>";var n=i.legal_isSatisfactory?'<option value="1">Approved</option>':'<option value="0">Declined</option>';if(document.getElementById("contractor--legal_isSatisfactory").innerHTML=n,document.getElementById("contractor--wsib_accountNumber").value=i.wsib_accountNumber,document.getElementById("contractor--wsib_firmNumber").value=i.wsib_firmNumber,i.wsib_effectiveDate){var s=new Date(i.wsib_effectiveDate),c=cityssm.dateToString(s);document.getElementById("contractor--wsib_effectiveDate").value=c}if(i.wsib_expiryDate){var r=new Date(i.wsib_expiryDate),o=cityssm.dateToString(r);document.getElementById("contractor--wsib_expiryDate").value=o}if(i.wsib_isIndependent&&(document.getElementById("contractor--wsib_isIndependent").checked=!0),document.getElementById("contractor--insurance_company").value=i.insurance_company||"",document.getElementById("contractor--insurance_policyNumber").value=i.insurance_policyNumber||"",document.getElementById("contractor--insurance_amount").value=i.insurance_amount.toString(),i.insurance_expiryDate){r=new Date(i.insurance_expiryDate),o=cityssm.dateToString(r);document.getElementById("contractor--insurance_expiryDate").value=o}if(e)for(var l=a.getElementsByClassName("contractor--contractorID"),d=0;d<l.length;d+=1)l[d].value=i.contractorID.toString()},onshown:function(t){if(e)for(var a=t.getElementsByClassName("is-unlock-button"),n=0;n<a.length;n+=1)a[n].classList.remove("is-hidden"),a[n].addEventListener("click",o)},onhidden:function(){c&&(d(),c=!1)},onremoved:function(){document.getElementsByTagName("html")[0].classList.remove("is-clipped")}})},d=function(){s=[],cityssm.clearElement(n),n.innerHTML='<div class="has-text-centered p-4"><span class="icon"><i class="fas fa-4x fa-spinner fa-pulse" aria-hidden="true"></i></span></div>',cityssm.postJSON(t+"/contractors/doGetContractors",a,function(e){if(0!==(s=e.contractors).length){var t=document.createElement("div");t.className="panel",s.forEach(function(e,a){var n=function(e,t){var a=document.createElement("div");a.className="panel-block is-block";var n=document.createElement("div");return n.className="columns is-mobile is-multiline",n.innerHTML='<div class="column is-full-mobile is-full-tablet is-half-widescreen"><a class="has-text-weight-bold" data-index="'+t.toString()+'" role="button" href="#">'+cityssm.escapeHTML(e.contractor_name)+"</a><br />"+(function(e){return e.isContractor&&e.healthSafety_isSatisfactory&&e.legal_isSatisfactory&&e.wsib_isSatisfactory&&e.insurance_isSatisfactory}(e)?'<span class="icon"><i class="fas fa-phone" aria-hidden="true"></i></span> <span>'+e.phone_number+"</span>":'<span class="has-text-weight-semibold has-text-danger"><span class="icon"><i class="fas fa-exclamation-triangle" aria-hidden="true"></i></span> Not Hire Ready</span>')+'</div><div class="column pt-4 has-text-centered">'+function(e){return'<span class="icon">'+(e.healthSafety_isSatisfactory?'<i class="fas fa-2x fa-check-circle has-text-success" aria-hidden="true"></i>':'<i class="fas fa-2x fa-times-circle has-text-danger" aria-hidden="true"></i>')+'</span><br /><span class="is-size-7 has-text-weight-semibold">Health & Safety</span>'}(e)+'</div><div class="column pt-4 has-text-centered">'+function(e){return'<span class="icon">'+(e.legal_isSatisfactory?'<i class="fas fa-2x fa-check-circle has-text-success" aria-hidden="true"></i>':'<i class="fas fa-2x fa-times-circle has-text-danger" aria-hidden="true"></i>')+'</span><br /><span class="is-size-7 has-text-weight-semibold">Legal</span>'}(e)+'</div><div class="column pt-4 has-text-centered">'+function(e){return'<span class="icon">'+(e.wsib_isSatisfactory?'<i class="fas fa-2x fa-check-circle has-text-success" aria-hidden="true"></i>':'<i class="fas fa-2x fa-times-circle has-text-danger" aria-hidden="true"></i>')+'</span><br /><span class="is-size-7 has-text-weight-semibold">WSIB</span>'}(e)+'</div><div class="column pt-4 has-text-centered">'+function(e){return'<span class="icon">'+(e.insurance_isSatisfactory?'<i class="fas fa-2x fa-check-circle has-text-success" aria-hidden="true"></i>':'<i class="fas fa-2x fa-times-circle has-text-danger" aria-hidden="true"></i>')+'</span><br /><span class="is-size-7 has-text-weight-semibold">Insurance</span>'}(e)+"</div>",n.getElementsByTagName("a")[0].addEventListener("click",l),a.appendChild(n),a}(e,a);t.appendChild(n)}),n.innerHTML="",n.appendChild(t)}else n.innerHTML='<div class="message is-info"><div class="message-body">There are no contractors available that meet your search criteria.</div></div>'})};a.addEventListener("submit",function(e){e.preventDefault()}),d(),document.getElementById("filter--tradeCategoryID").addEventListener("change",d),document.getElementById("filter--isHireReady").addEventListener("change",function(){d()})}();